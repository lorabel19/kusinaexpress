{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KusinaExpress | Manage Menu</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { display:flex; min-height:100vh; background-color:#fffaf3; color:#2d2d2d; }

/* Sidebar */
.sidebar { width:250px; background-color:#d62828; color:white; display:flex; flex-direction:column; padding:20px; position:sticky; top:0; height:100vh; }
.sidebar h2 { font-size:22px; margin-bottom:30px; }
.sidebar a { color:white; text-decoration:none; padding:12px 15px; margin-bottom:10px; border-radius:6px; display:block; transition:0.3s; }
.sidebar a:hover { background-color:#fcbf49; color:#2d2d2d; }

/* Main content */
.main-content { flex:1; padding:30px; overflow-y:auto; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; }
header h1 { font-size:28px; color:#d62828; }
.btn { padding:8px 15px; border:none; border-radius:6px; cursor:pointer; font-weight:600; transition:0.3s; }
.btn-add { background-color:#fcbf49; color:#2d2d2d; margin-bottom:15px; }
.btn-add:hover { background-color:#2d2d2d; color:white; }
.btn-edit { background-color:#fcbf49; color:#2d2d2d; }
.btn-edit:hover { background-color:#2d2d2d; color:white; }
.btn-delete { background-color:#d62828; color:white; }
.btn-delete:hover { background-color:#2d2d2d; color:white; }

/* Table */
table { width:100%; border-collapse:collapse; background:white; border-radius:12px; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,0.1); margin-top:20px; }
th, td { padding:15px; text-align:left; vertical-align:middle; }
th { background-color:#d62828; color:white; }
tr:nth-child(even) { background:#f8f8f8; }
tr:hover { background: lightyellow; color:#2d2d2d; }
td img { width:80px; height:50px; object-fit:cover; border-radius:6px; }

/* Actions buttons side by side */
td.actions {
    display: flex;
    gap: 5px; /* space between buttons */
    align-items: center;
}

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background:white; margin:10% auto; padding:20px; border-radius:12px; width:90%; max-width:500px; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
.modal-header h2 { color:#d62828; }
.modal-header .close { cursor:pointer; font-size:24px; font-weight:bold; }

/* Form */
.modal form { display:flex; flex-direction:column; gap:10px; }
.modal input, .modal textarea, .modal select { padding:10px; border-radius:6px; border:1px solid #ccc; width:100%; }
.modal button { margin-top:10px; }

/* Footer */
footer { margin-top:50px; text-align:center; padding:15px; color:#555; font-size:14px; }
</style>
</head>
<body>

<div class="sidebar">
  <h2>KusinaAdmin</h2>
  <a href="{% url 'restaurant:admin-dashboard' %}">Dashboard</a>
  <a href="{% url 'restaurant:admin-menu' %}">Manage Menu</a>
  <a href="{% url 'restaurant:admin-orders' %}">Manage Orders</a>
  <a href="#">Users</a>
  <a href="#">Feedback</a>
  <a href="#">Logout</a>
</div>

<div class="main-content">
  <header>
    <h1>Manage Menu</h1>
    <button class="btn btn-add" onclick="openModal('addModal')">Add New Item</button>
  </header>

  <table>
    <thead>
      <tr>
        <th>Item ID</th>
        <th>Image</th>
        <th>Name</th>
        <th>Description</th>
        <th>Price</th>
        <th>Category</th>
        <th>Available</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for item in menu_items %}
      <tr>
        <td>{{ item.item_id }}</td>
        <td><img src="{{ item.image_url|default:'https://via.placeholder.com/80x50?text=No+Image' }}" alt="{{ item.name }}"></td>
        <td>{{ item.name }}</td>
        <td>{{ item.description }}</td>
        <td>â‚±{{ item.price }}</td>
        <td>{{ item.category|title }}</td>
        <td>{% if item.is_available %}Yes{% else %}Not Available{% endif %}</td>
        <td class="actions">
          <button class="btn btn-edit"
            data-id="{{ item.item_id }}"
            data-name="{{ item.name|escapejs }}"
            data-desc="{{ item.description|escapejs }}"
            data-price="{{ item.price }}"
            data-category="{{ item.category|escapejs }}"
            data-image="{{ item.image_url|escapejs }}"
            data-available="{{ item.is_available|default_if_none:0 }}"
            onclick="openEditModalFromButton(this)">
            Edit
          </button>
          <a href="{% url 'restaurant:admin-delete-menu' item.item_id %}" class="btn btn-delete">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8">No menu items found.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Add Modal -->
  <div id="addModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Menu Item</h2>
        <span class="close" onclick="closeModal('addModal')">&times;</span>
      </div>
      <form method="POST" action="{% url 'restaurant:admin-add-menu' %}">
        {% csrf_token %}
        <input type="text" name="name" placeholder="Item Name" required>
        <textarea name="description" placeholder="Description"></textarea>
        <input type="number" name="price" placeholder="Price" step="0.01" required>

        <!-- Category Dropdown -->
        <select name="category" required>
          <option value="" disabled selected>Select Category</option>
          <option value="meals">Meals</option>
          <option value="drinks">Drinks</option>
          <option value="desserts">Desserts</option>
        </select>

        <input type="text" name="image_url" placeholder="Image URL">
        <select name="is_available">
          <option value="1" selected>Available</option>
          <option value="0">Not Available</option>
        </select>
        <button type="submit" class="btn btn-add">Add Item</button>
      </form>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Menu Item</h2>
        <span class="close" onclick="closeModal('editModal')">&times;</span>
      </div>
      <form method="POST" id="editForm">
        {% csrf_token %}
        <input type="text" name="name" id="editName" placeholder="Item Name" required>
        <textarea name="description" id="editDescription" placeholder="Description"></textarea>
        <input type="number" name="price" id="editPrice" placeholder="Price" step="0.01" required>

        <!-- Category Dropdown -->
        <select name="category" id="editCategory" required>
          <option value="meals">Meals</option>
          <option value="drinks">Drinks</option>
          <option value="desserts">Desserts</option>
        </select>

        <input type="text" name="image_url" id="editImage" placeholder="Image URL">
        <select name="is_available" id="editAvailable">
          <option value="1">Available</option>
          <option value="0">Not Available</option>
        </select>
        <button type="submit" class="btn btn-add">Save Changes</button>
      </form>
    </div>
  </div>

  
</div>

<script>
// Modal functions
function openModal(id){ document.getElementById(id).style.display = 'block'; }
function closeModal(id){ document.getElementById(id).style.display = 'none'; }
window.onclick = function(event){
  if(event.target.classList.contains('modal')){ event.target.style.display = 'none'; }
}

// Edit modal pre-fill from data-* attributes
function openEditModalFromButton(btn){
  openModal('editModal');
  document.getElementById('editForm').action = `/admin-menu/edit/${btn.dataset.id}/`;
  document.getElementById('editName').value = btn.dataset.name;
  document.getElementById('editDescription').value = btn.dataset.desc;
  document.getElementById('editPrice').value = btn.dataset.price;
  document.getElementById('editCategory').value = btn.dataset.category;
  document.getElementById('editImage').value = btn.dataset.image;
  document.getElementById('editAvailable').value = btn.dataset.available;
}
</script>

</body>
</html>
